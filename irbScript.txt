require 'net/http'
require 'cgi'
require 'json'
API_URL = "http://pdc-eds-api/"
API_URL_S = "https://edc-eds-api/"
@userid = 'yale_api'
@password = 'yal3_ap1'
@profile = 'yale_api'
xml = "<UIDAuthRequestMessage xmlns='http://www.ebscohost.com/services/public/AuthService/Response/2012/06/01'><UserId>#{@userid}</UserId><Password>#{@password}</Password></UIDAuthRequestMessage>"
uri = URI "#{API_URL_S}authservice/rest/uidauth"
req = Net::HTTP::Post.new(uri.request_uri)
req["Content-Type"] = "application/xml"
req["Accept"] = "application/json" #if format == :json
req.body = xml
https = Net::HTTP.new(uri.hostname, uri.port)
https.use_ssl = true
https.verify_mode = OpenSSL::SSL::VERIFY_NONE
doc = JSON.parse(https.request(req).body)
@auth_token = doc['AuthToken']

--- SESSION

uri = URI "#{API_URL}edsapi/rest/createsession?profile=#{@profile}"
req = Net::HTTP::Get.new(uri.request_uri)
req['x-authenticationToken'] = @auth_token
req['Accept'] = "application/json"
Net::HTTP.start(uri.hostname, uri.port) { |http|
  			doc = JSON.parse(http.request(req).body)
				return doc['SessionToken']
			}